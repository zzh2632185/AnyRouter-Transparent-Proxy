# Web 管理面板任务文档

- [x] 1. 扩展 FastAPI 应用添加认证中间件
  - 文件: app.py (修改现有)
  - 实现 Bearer Token 认证中间件函数
  - 添加环境变量 DASHBOARD_API_KEY 验证
  - 目的: 保护管理面板 API 端点
  - _利用: 现有的环境变量加载机制_
  - _需求: 5.1, 5.2_
  - _Prompt: 角色: Python 后端开发工程师，精通 FastAPI 中间件和认证 | 任务: 实现基于 Bearer Token 的认证中间件，验证 DASHBOARD_API_KEY 环境变量，为管理 API 提供安全保护 | 限制: 必须与现有代码风格保持一致，不能破坏原有代理功能，需要正确处理认证失败场景 | 成功: 认证中间件正确工作，有效 Token 可以访问，无效 Token 返回 401_

- [x] 2. 添加静态文件服务路由
  - 文件: app.py (修改现有)
  - 使用 FastAPI StaticFiles 挂载静态文件
  - 配置 /admin 路径映射到 static 目录
  - 添加 ENABLE_DASHBOARD 开关控制
  - 目的: 服务前端 Vue 应用
  - _利用: FastAPI StaticFiles 中间件_
  - _需求: 5.1_
  - _Prompt: 角色: Python 后端开发工程师，精通 FastAPI 静态文件服务 | 任务: 在 app.py 中添加静态文件服务，将 /admin 路径映射到 static 目录，实现条件启用机制 | 限制: 必须使用 ENABLE_DASHBOARD 环境变量控制，不影响代理路由，支持子路径部署 | 成功: /admin 路径可以正确访问前端应用，代理功能不受影响_

- [x] 3. 创建配置管理 API
  - 文件: app.py (新增函数)
  - 实现 GET /api/admin/config 获取配置
  - 实现 PUT /api/admin/config 更新配置
  - 添加配置验证和错误处理
  - 目的: 提供配置管理 API 接口
  - _利用: 现有的环境变量加载机制_
  - _需求: 2.1, 2.2, 2.3_
  - _Prompt: 角色: Python 后端开发工程师，精通配置管理和 API 设计 | 任务: 创建配置管理 API 端点，实现配置读取、更新和验证功能，支持 JSON 响应格式 | 限制: 必须验证配置格式，处理无效配置，保持与现有配置系统兼容 | 成功: API 可以正确读取和更新配置，无效配置返回适当错误信息_

- [x] 4. 实现统计数据收集器
  - 文件: app.py (新增函数和全局变量)
  - 添加请求统计计数器
  - 实现时间窗口聚合
  - 错误信息收集和存储
  - 目的: 收集系统运行统计数据
  - _利用: 现有的代理函数和日志系统_
  - _需求: 3.1, 3.2_
  - _Prompt: 角色: Python 后端开发工程师，精通数据收集和统计 | 任务: 在现有代理函数中添加统计收集逻辑，实现请求计数、性能指标和错误信息收集 | 限制: 不能影响代理性能，使用内存存储，实现线程安全 | 成功: 统计数据准确收集，API 可以返回实时统计信息_

- [x] 5. 创建统计和监控 API
  - 文件: app.py (新增函数)
  - 实现 GET /api/admin/stats 返回系统统计
  - 实现 GET /api/admin/errors 返回错误信息
  - 添加时间范围过滤支持
  - 目的: 提供监控数据 API
  - _利用: 统计收集器数据_
  - _需求: 3.1, 3.2_
  - _Prompt: 角色: Python 后端开发工程师，精通数据 API 和监控指标 | 任务: 创建监控 API 端点，返回系统统计、错误信息和性能指标，支持时间过滤 | 限制: 数据格式必须匹配前端需求，支持实时更新，处理大量历史数据 | 成功: API 返回格式正确的监控数据，支持实时和历史查询_

- [x] 6. 实现日志流 SSE 端点
  - 文件: app.py (新增函数)
  - 实现 GET /api/admin/logs/stream SSE 流
  - 添加日志级别过滤
  - 实现实时日志推送
  - 目的: 提供实时日志流服务
  - _利用: Python logging 系统, asyncio_
  - _需求: 4.1, 4.2_
  - _Prompt: 角色: Python 后端开发工程师，精通 SSE 和异步编程 | 任务: 实现基于 EventSource 的日志流 API，支持实时推送和日志过滤 | 限制: 必须使用 SSE 协议，处理客户端断开连接，支持大量并发连接 | 成功: 客户端可以接收实时日志流，支持过滤和断线重连_

- [x] 7. 初始化 Vue 3 前端项目
  - 文件: frontend/ (创建目录结构)
  - 使用 create-vue 创建项目
  - 配置 TypeScript 和 Tailwind CSS 4
  - 设置 Vite 构建配置
  - 目的: 建立前端开发环境
  - _利用: Vite, Vue 3, TypeScript, Tailwind CSS_
  - _需求: 6.1, 6.2_
  - _Prompt: 角色: 前端工程师，精通 Vue 3 和现代前端工具链 | 任务: 初始化 Vue 3 项目，配置 TypeScript、Tailwind CSS 4 和 Vite，设置开发环境 | 限制: 必须使用 Vue 3.5.13，配置子路径部署 /admin，集成 Tailwind CSS 4 | 成功: 项目可以正常开发和构建，支持子路径部署_

- [x] 8. 创建基础布局组件
  - 文件: frontend/src/components/BaseLayout.vue
  - 实现响应式侧边栏导航
  - 添加移动端抽屉式导航
  - 集成暗色模式切换
  - 目的: 提供应用基础布局框架
  - _利用: Vue Router, Tailwind CSS_
  - _需求: 6.3, 6.4_
  - _Prompt: 角色: Vue 前端工程师，精通响应式设计和组件架构 | 任务: 创建响应式基础布局组件，支持桌面和移动端，集成暗色模式功能 | 限制: 必须使用 Tailwind CSS 实现样式，支持移动端适配，组件可复用 | 成功: 布局在不同设备上正确显示，导航功能正常，暗色模式可切换_

- [x] 9. 实现仪表板视图
  - 文件: frontend/src/views/Dashboard.vue
  - 创建系统状态概览卡片
  - 集成 Chart.js 实时图表
  - 添加关键指标展示
  - 目的: 实现仪表板主页面
  - _利用: Chart.js, API services, 组合函数_
  - _需求: 1.1, 1.2_
  - _Prompt: 角色: Vue 前端工程师，精通数据可视化和实时更新 | 任务: 实现仪表板视图，展示系统状态、实时图表和关键指标，支持自动更新 | 限制: 必须使用 Chart.js 实现图表，数据通过 API 获取，支持实时更新 | 成功: 仪表板正确显示系统状态，图表实时更新，响应式设计_

- [x] 10. 创建配置管理视图
  - 文件: frontend/src/views/Config.vue
  - 实现配置表单编辑器
  - 添加配置验证提示
  - 支持配置导入导出
  - 目的: 提供配置管理界面
  - _利用: 表单组件, API services, 验证逻辑_
  - _需求: 2.1, 2.2, 2.3_
  - _Prompt: 角色: Vue 前端工程师，精通表单处理和状态管理 | 任务: 创建配置管理视图，实现配置编辑、验证和导入导出功能 | 限制: 必须实时验证配置，支持不同数据类型，提供友好的错误提示 | 成功: 配置可以正确编辑和保存，验证功能正常，导入导出工作_

- [x] 11. 实现监控中心视图
  - 文件: frontend/src/views/Monitoring.vue
  - 创建实时请求状态展示
  - 添加错误信息查看器
  - 实现性能指标图表
  - 目的: 提供实时监控界面
  - _利用: 实时图表组件, SSE 客户端, 错误查看器_
  - _需求: 3.1, 3.2, 3.3_
  - _状态: 已完成 - 实现了包含实时数据展示、图表可视化、错误查看和热门路径分析的完整监控界面_

- [x] 12. 创建日志查看器视图
  - 文件: frontend/src/views/Logs.vue
  - 实现虚拟滚动日志列表
  - 添加日志搜索和过滤
  - 集成 SSE 日志流
  - 目的: 提供日志查看和搜索界面
  - _利用: 虚拟滚动, SSE 客户端, 搜索组件_
  - _需求: 4.1, 4.2, 4.3_
  - _状态: 已完成 - 实现了包含虚拟滚动、实时日志流、搜索过滤、级别筛选和自动滚动功能的完整日志查看器_

- [x] 13. 实现 API 服务层
  - 文件: frontend/src/services/api.ts
  - 创建 HTTP 客户端封装
  - 实现 API 调用函数
  - 添加错误处理和重试
  - 目的: 提供 API 调用基础设施
  - _利用: Ky HTTP 客户端, TypeScript 类型_
  - _需求: 所有 API 调用_
  - _状态: 已完成 - 基于 Ky HTTP 客户端实现完整的 API 服务层，包含认证、错误处理、重试机制和类型安全_

- [x] 14. 创建状态管理 Store
  - 文件: frontend/src/stores/index.ts
  - 使用 Pinia 管理应用状态
  - 实现用户配置和主题状态
  - 添加缓存和持久化
  - 目的: 管理前端应用状态
  - _利用: Pinia, localStorage, TypeScript_
  - _需求: 6.1, 6.2_
  - _状态: 已完成 - 实现了主题、配置、统计、日志和认证五个 Store，支持持久化和自动刷新_

- [x] 15. 添加实时数据组合函数
  - 文件: frontend/src/composables/useRealtime.ts
  - 创建 SSE 连接管理
  - 实现自动重连机制
  - 添加数据缓存和更新
  - 目的: 提供实时数据处理能力
  - _利用: EventSource API, Vue 3 响应式系统_
  - _需求: 3.1, 4.1_
  - _状态: 已完成 - 实现了包含日志流、统计数据和错误监控三个组合函数，支持自动重连、心跳检测和资源管理_

- [x] 16. 更新 Docker 构建流程
  - 文件: Dockerfile (修改)
  - 添加 Node.js 构建环境
  - 集成前端构建步骤
  - 优化镜像大小
  - 目的: 支持 Docker 部署
  - _利用: 多阶段构建, Docker 缓存优化_
  - _需求: 部署需求_
  - _状态: 已完成 - 实现了多阶段构建流程，包含前端构建和后端部署，优化了镜像大小和安全性_

- [x] 17. 创建前端构建脚本
  - 文件: scripts/build-frontend.sh (新增)
  - 自动化前端构建流程
  - 集成到 CI/CD 流水线
  - 添加构建验证
  - 目的: 自动化构建部署流程
  - _利用: npm/Vite 构建命令_
  - _需求: 部署需求_
  - _状态: 已完成 - 创建了完整的前端构建脚本，包含依赖管理、类型检查、构建验证和错误处理_

- [x] 18. 集成测试和验证
  - 文件: 测试文件 (多个)
  - 端到端功能测试
  - 性能和兼容性测试
  - 安全性验证
  - 目的: 确保功能完整性和质量
  - _利用: 测试框架, 手动测试_
  - _需求: 所有需求_
  - _状态: 已完成 - 实现了自动化测试脚本、CI/CD 流水线配置和完整的部署文档_